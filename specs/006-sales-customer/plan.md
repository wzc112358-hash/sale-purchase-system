# Implementation Plan: 销售客户管理

**Branch**: `006-sales-customer` | **Date**: 2026-02-18 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/006-sales-customer/spec.md`

## Summary

实现销售客户管理功能，包括客户列表展示、搜索筛选、新增编辑、详情查看、删除等完整CRUD操作。销售职员只能管理自己创建的客户数据。

## Technical Context

**Language/Version**: TypeScript 5.x  
**Primary Dependencies**: React 18+, Ant Design, PocketBase SDK, react-router-dom v6  
**Storage**: PocketBase (customers collection)  
**Testing**: Vitest  
**Target Platform**: Web Browser  
**Project Type**: Single Web Application  
**Performance Goals**: 页面加载<5秒，搜索响应<1秒  
**Constraints**: 遵循需求文档汇总.md第四部分页面样式设计规范  
**Scale/Scope**: 单用户数据隔离，支持分页

## Constitution Check

| Constitution Requirement | Status | Notes |
|--------------------------|--------|-------|
| TypeScript-First Development | PASS | 使用TypeScript显式类型定义 |
| Component-Based Architecture | PASS | React组件化实现 |
| Role-Based Access Control | PASS | 销售人员只能管理本人创建的客户 |
| Data Integrity | PASS | 遵循数据模型规范 |
| UI/UX Standards | PASS | 遵循设计规范（色彩、布局、组件） |
| Technology Stack | PASS | React + TypeScript + Ant Design + PocketBase |
| API Standards | PASS | PocketBase SDK模式 |
| Code Quality | PASS | 使用接口定义Props |

## Project Structure

### Documentation (this feature)

```text
specs/006-sales-customer/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
│   └── api.md          # API contract
└── tasks.md            # Phase 2 output (NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
src/
├── api/
│   └── customer.ts      # Customer API module
├── components/
│   └── common/         # Common components (Table, Modal, Form)
├── pages/
│   └── sales/
│       └── customers/  # Customer pages (List, Detail)
├── types/
│   └── customer.ts     # Customer type definitions
└── stores/             # State management
```

**Structure Decision**: 使用React组件化架构，客户管理模块位于 `src/pages/sales/customers/`，API调用封装在 `src/api/customer.ts`

## Phase 0: Research

### Research Tasks

1. **PocketBase客户表查询优化**: 研究PocketBase的filter语法和分页API
2. **Ant Design Table组件**: 研究表格组件的分页、搜索、筛选实现
3. **表单验证最佳实践**: 研究Ant Design Form的验证规则配置

### Decisions

- **Decision**: 使用Ant Design的Form和Table组件构建客户管理界面
- **Rationale**: 项目已选择Ant Design作为UI组件库，与现有系统保持一致
- **Alternatives considered**: Material-UI

## Phase 1: Design

### Data Model

从功能需求中提取实体：

| Entity | Fields | Relationships |
|--------|--------|---------------|
| Customer | name, contact, phone, email, address, industry, region, bank_name, bank_account, remark, creator | creator -> User |
| SalesContract | no, product_name, customer, total_amount, status | customer -> Customer |

### API Contracts

| Endpoint | Method | Description |
|----------|--------|-------------|
| /api/customers | GET | 获取客户列表（支持分页、搜索、筛选） |
| /api/customers | POST | 创建新客户 |
| /api/customers/:id | GET | 获取客户详情 |
| /api/customers/:id | PATCH | 更新客户信息 |
| /api/customers/:id | DELETE | 删除客户 |
| /api/customers/:id/contracts | GET | 获取客户关联的销售合同列表 |

## Phase 2: Tasks

*To be generated by `/speckit.tasks` command*

---

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | - | - |
