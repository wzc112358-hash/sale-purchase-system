# Feature Specification: 销售合同管理

**Feature Branch**: `007-sales-contract`  
**Created**: 2026-02-18  
**Status**: Draft  
**Input**: User description: "销售合同管理：实现销售合同的创建、编辑、删除、列表查看、详情查看功能，包含合同与客户的关联、附件上传下载、合同状态自动更新"

## Clarifications

### Session 2026-02-18

- Q: 合同金额为0时如何处理？ → A: 合同金额为0时不允许创建，系统必须验证并提示错误
- Q: 合同执行进度达到100%时如何处理？ → A: 合同执行进度达到100%时，状态自动更新为"已完成"（completed）
- Q: 同一产品名称的合同编号是否允许重复？ → A: 允许手动输入，可重复
- Q: 页面样式设计要求？ → A: 需遵循需求文档第四部分的设计规范，包括色彩体系、字体、卡片样式、按钮样式等

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看销售合同列表 (Priority: P1)

销售职员需要查看所有销售合同的基本信息，包括合同编号、产品名称、客户名称、签订日期、合同总金额、执行进度、收款进度、开票进度和合同状态。

**Why this priority**: 这是销售职员日常工作的基础需求，需要快速了解所有合同的整体情况。

**Independent Test**: 打开合同列表页面，可以看到表格展示所有销售合同信息，支持搜索和分页。

**Acceptance Scenarios**:

1. **Given** 用户登录为销售职员，**When** 访问销售合同列表页面，**Then** 看到所有本人创建的合同以表格形式展示
2. **Given** 合同列表有多页数据，**When** 点击分页控件，**Then** 切换显示对应页的数据
3. **Given** 输入搜索关键词，**When** 点击搜索按钮，**Then** 过滤显示符合条件的合同

---

### User Story 2 - 创建新销售合同 (Priority: P1)

销售职员需要创建新的销售合同，关联到具体客户，输入产品信息并自动计算总金额。

**Why this priority**: 签订新合同是销售的核心业务活动，必须能够快速创建合同并关联客户。

**Independent Test**: 填写合同表单，选择客户，输入产品名称、单价和数量，提交后创建成功。

**Acceptance Scenarios**:

1. **Given** 销售职员点击"新增合同"按钮，**When** 填写必填字段（客户、产品名称、单价、数量、签订日期）并提交，**Then** 合同创建成功，自动生成合同编号
2. **Given** 填写合同信息时，**When** 输入单价和数量后，**Then** 系统自动计算并显示总金额
3. **Given** 未填写必填字段提交表单，**Then** 显示验证错误提示
4. **Given** 合同创建成功，**Then** 系统自动向采购职员发送通知

---

### User Story 3 - 编辑和删除合同 (Priority: P1)

销售职员需要修改已有合同的信息，或删除不再需要的合同。

**Why this priority**: 合同信息可能需要调整，或合同取消时需要删除。

**Independent Test**: 打开合同编辑页面，修改信息后保存；或点击删除按钮确认删除。

**Acceptance Scenarios**:

1. **Given** 合同列表中的某条记录，**When** 点击编辑按钮，**Then** 弹出编辑表单并填充现有数据
2. **Given** 修改合同信息并提交，**Then** 更新成功，列表和详情页显示新数据
3. **Given** 合同列表中的某条记录，**When** 点击删除按钮，**Then** 弹出确认对话框
4. **Given** 确认删除合同，**Then** 合同从系统中移除，列表刷新

---

### User Story 4 - 查看合同详情 (Priority: P2)

销售职员需要查看合同的完整信息，包括关联的客户、发货批次、发票记录和收款记录。

**Why this priority**: 查看合同详情是跟进合同执行情况的基础，需要全面了解合同的所有关联数据。

**Independent Test**: 点击合同列表中的某条记录，进入详情页面查看完整信息。

**Acceptance Scenarios**:

1. **Given** 合同列表中的某条记录，**When** 点击查看详情，**Then** 展示合同基本信息
2. **Given** 在合同详情页面，**When** 查看关联的客户信息，**Then** 显示客户名称和联系方式
3. **Given** 在合同详情页面，**When** 查看发货批次列表，**Then** 显示该合同下的所有发货记录及进度
4. **Given** 在合同详情页面，**When** 查看发票列表，**Then** 显示该合同下的所有发票记录
5. **Given** 在合同详情页面，**When** 查看收款记录列表，**Then** 显示该合同下的所有收款记录及收款进度

---

### User Story 5 - 合同附件管理 (Priority: P2)

销售职员需要上传合同附件（如PDF、图片），并能够查看和下载已上传的附件。

**Why this priority**: 合同附件是合同的重要组成部分，需要妥善管理和方便查阅。

**Independent Test**: 在合同表单中上传附件，保存后可在详情页查看和下载。

**Acceptance Scenarios**:

1. **Given** 创建或编辑合同，**When** 上传合同附件并保存，**Then** 附件与合同关联存储
2. **Given** 查看合同详情，**When** 存在已上传的附件，**Then** 显示附件列表
3. **Given** 附件列表中的某个文件，**When** 点击下载按钮，**Then** 下载该文件到本地

---

### Edge Cases

- 当客户被删除时，该客户关联的合同保留，但客户信息显示为"已删除"
- 合同金额为零或负数时不允许创建（系统必须验证并提示错误）
- 合同执行进度达到100%时，状态自动更新为"已完成"（completed）
- 合同金额为零或负数时不允许创建（系统必须验证并提示错误）
- 合同执行进度达到100%时，状态自动更新为"已完成"（completed）
- 合同编号允许手动输入，可重复

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须允许销售职员查看本人创建的所有销售合同列表
- **FR-002**: 系统必须支持销售合同的分页展示，每页显示数量可配置
- **FR-003**: 系统必须支持按合同编号、客户名称、产品名称搜索合同
- **FR-004**: 系统必须允许销售职员创建新的销售合同
- **FR-005**: 系统必须允许销售职员编辑已有合同的信息
- **FR-006**: 系统必须允许销售职员删除不再需要的合同
- **FR-007**: 系统必须允许销售职员手动输入合同编号
- **FR-008**: 系统必须根据输入的单价和数量自动计算总金额
- **FR-009**: 系统必须支持合同附件上传（PDF、图片等格式）
- **FR-010**: 系统必须允许查看和下载合同附件
- **FR-011**: 系统必须在合同创建成功后自动通知采购职员
- **FR-012**: 合同详情页面必须展示关联的客户信息
- **FR-013**: 合同详情页面必须展示发货批次列表及执行进度
- **FR-014**: 合同详情页面必须展示发票列表及开票进度
- **FR-015**: 合同详情页面必须展示收款记录列表及收款进度
- **FR-016**: 系统必须自动更新合同的执行进度百分比
- **FR-017**: 系统必须自动更新合同的收款进度和欠款金额
- **FR-018**: 系统必须验证合同金额大于0，金额为0或负数时不允许创建
- **FR-019**: 当合同执行进度达到100%时，系统必须自动将合同状态更新为"已完成"
- **FR-020**: 合同编号允许重复（同一产品可签订多份合同）

### UI/UX 设计要求

根据需求文档第四部分，本功能页面需遵循以下设计规范：

- **色彩体系**：主背景 #FFFFFF，主要文本 #333333，次要文本 #999999，主按钮背景 #1A1A1A
- **字体**：无衬线字体（如 Inter、PingFang SC、Helvetica）
- **数据卡片**：白色背景，圆角 12px，轻微阴影，内边距上下 24px/左右 20px
- **按钮样式**：主按钮深色背景圆角 8px，次要按钮浅灰边框圆角 16px
- **表格**：展示合同编号、品名、客户、签订日期、总金额、执行进度、收款进度、开票进度、状态
- **进度条**：百分比进度条形式展示执行/收款/开票进度

### Key Entities

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 销售职员可以在5秒内加载并查看合同列表页面
- **SC-002**: 创建新合同的表单提交后3秒内完成保存并显示成功
- **SC-003**: 所有合同列表支持至少1000条数据的分页显示
- **SC-004**: 合同创建后，采购职员在10秒内收到系统通知
- **SC-005**: 合同执行进度、收款进度、开票进度百分比计算正确率100%
- **SC-006**: 附件上传支持最大10MB的文件
- **SC-007**: 用户满意度达到90%以上，能够顺利完成合同管理任务
